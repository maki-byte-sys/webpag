<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Student - Enrollment System</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<!-- Header -->
<div class="container-fluid header-section">
    <div class="text-center">
        <h1 class="system-title">Enrollment System</h1>
        <p class="institution">Binalatongan Community College</p>
    </div>
</div>

<!-- Navigation -->
<div class="container-fluid nav-section">
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link" href="index.html">
                <i class="fas fa-user-graduate"></i> Student
            </a>
        </li>
        <li class="nav-item"><a class="nav-link" href="#"><i class="fas fa-chalkboard-teacher"></i> Teacher</a></li>
        <li class="nav-item"><a class="nav-link" href="#"><i class="fas fa-book"></i> Subject</a></li>
        <li class="nav-item"><a class="nav-link" href="#"><i class="fas fa-lock"></i> Class Access</a></li>
    </ul>
</div>

<div class="container main-content mt-4">

    <!-- Alerts -->
    <div id="alert-area"></div>

    <!-- Back Button -->
    <a id="backBtn" class="btn btn-secondary mb-4">
        <i class="fas fa-arrow-left me-2"></i>Back to Student List
    </a>

    <!-- Form Card -->
    <div class="card form-card">
        <div class="card-header">
            <h3><i class="fas fa-edit me-2"></i>Student Edit</h3>
        </div>
        <div class="card-body">

            <form id="studentForm">
                <div class="row">

                    <div class="col-md-6 mb-3">
                        <label class="form-label">First Name *</label>
                        <input type="text" class="form-control" id="first_name" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Last Name *</label>
                        <input type="text" class="form-control" id="last_name" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Phone *</label>
                        <input type="tel" class="form-control" id="phone" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Middle Name</label>
                        <input type="text" class="form-control" id="middle_name">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Course *</label>
                        <select class="form-select" id="course" required>
                            <option value="BSIT">BSIT</option>
                            <option value="BED">BED</option>
                            <option value="BSBA">BSBA</option>
                            <option value="BSHM">BSHM</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn btn-warning btn-lg">
                    <i class="fas fa-save me-2"></i>Update Student
                </button>

                <a id="cancelBtn" class="btn btn-secondary btn-lg ms-2">
                    <i class="fas fa-times me-2"></i>Cancel
                </a>
            </form>

        </div>
    </div>

    <!-- Footer -->
    <footer class="footer text-center mt-4">
        <p>Enrollment System © 2025</p>
        <p class="small">IT ELEC 3 – Data Mining</p>
    </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* =========================
   Helpers
========================= */

function sanitize(value) {
    return value.trim().replace(/[<>]/g, "");
}

function showAlert(message, type = "danger") {
    document.getElementById("alert-area").innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
}

/* =========================
   Load Student
========================= */

const params = new URLSearchParams(window.location.search);
const studentId = params.get("id");
const page = params.get("page") || 1;

document.getElementById("backBtn").href = `index.html?page=${page}`;
document.getElementById("cancelBtn").href = `index.html?page=${page}`;

const students = JSON.parse(localStorage.getItem("students")) || [];
const studentIndex = students.findIndex(s => s.id == studentId);

if (studentIndex === -1) {
    window.location.href = "index.html";
}

const student = students[studentIndex];

// Populate fields
first_name.value = student.firstName;
last_name.value = student.lastName;
middle_name.value = student.middleName || "";
email.value = student.email;
phone.value = student.phone;
course.value = student.course;

/* =========================
   Update Student
========================= */

document.getElementById("studentForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const updatedStudent = {
        ...student,
        firstName: sanitize(first_name.value),
        lastName: sanitize(last_name.value),
        middleName: sanitize(middle_name.value),
        email: sanitize(email.value),
        phone: sanitize(phone.value),
        course: sanitize(course.value)
    };

    if (!updatedStudent.firstName || !updatedStudent.lastName || !updatedStudent.course) {
        showAlert("Please fill in all required fields.");
        return;
    }

    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(updatedStudent.email)) {
        showAlert("Please enter a valid email address.");
        return;
    }

    students[studentIndex] = updatedStudent;
    localStorage.setItem("students", JSON.stringify(students));

    showAlert("Student updated successfully!", "success");

    setTimeout(() => {
        window.location.href = `index.html?page=${page}&success=1`;
    }, 1500);
});
</script>

</body>
</html>
