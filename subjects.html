<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subjects - Enrollment System</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
* { font-family: 'Poppins', sans-serif; }

body {
    background: linear-gradient(135deg, #eef2f7, #f8f9fb);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.header-section {
    padding: 80px 20px;
    background: linear-gradient(135deg, #6f42c1, #845ef7);
    color: #fff;
}

.header-card {
    max-width: 700px;
    margin: auto;
    background: rgba(255,255,255,0.15);
    border-radius: 25px;
    padding: 35px;
    backdrop-filter: blur(12px);
    box-shadow: 0 25px 60px rgba(0,0,0,0.3);
}

.school-icon {
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    margin: auto auto 15px;
}

.nav-section {
    box-shadow: 0 6px 20px rgba(0,0,0,0.05);
}

.nav-tabs .nav-link.active {
    background: linear-gradient(135deg, #6f42c1, #845ef7);
    color: #fff;
    border-radius: 8px;
}

.card {
    border: none;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.08);
}

table tbody tr:hover {
    background: #faf7ff;
}

footer {
    margin-top: auto;
    background: #fff;
    border-top: 1px solid #e5e5e5;
    padding: 20px 0;
}
</style>
</head>
<body>

<div class="container-fluid header-section text-center">
    <div class="header-card">
        <div class="school-icon">
            <i class="fas fa-university"></i>
        </div>
        <h1>Enrollment System</h1>
        <p>Binalatongan Community College</p>
    </div>
</div>

<div class="container-fluid nav-section bg-light py-2">
<div class="d-flex justify-content-between align-items-center">
<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link" href="index.html">
            <i class="fas fa-user-graduate"></i> Student
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="teachers.html">
            <i class="fas fa-chalkboard-teacher"></i> Teacher
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link active" href="subjects.html">
            <i class="fas fa-book"></i> Subject
        </a>
    </li>
</ul>
</div>
</div>

<div class="container mt-4 mb-5">

<div class="card">
<div class="card-header d-flex justify-content-between align-items-center">
    <h4><i class="fas fa-book"></i> Subject List</h4>
    <a href="add_subject.html" class="btn btn-success">
        <i class="fas fa-plus"></i> Add Subject
    </a>
</div>

<div class="card-body">

<form id="searchForm" class="row g-2 mb-3">
    <div class="col-md-8">
        <input id="searchInput" class="form-control" placeholder="Search subject, code, course">
    </div>
    <div class="col-md-2">
        <button class="btn btn-outline-secondary w-100">
            <i class="fas fa-search"></i>
        </button>
    </div>
    <div class="col-md-2">
        <button type="button" id="clearSearch" class="btn btn-secondary w-100 d-none">
            Clear
        </button>
    </div>
</form>

<div class="table-responsive">
<table class="table table-hover">
<thead class="table-light">
<tr>
    <th>#</th>
    <th>Code</th>
    <th>Name</th>
    <th>Units</th>
    <th>Course</th>
    <th>Year</th>
    <th>Status</th>
    <th>Action</th>
</tr>
</thead>
<tbody id="subjectTable"></tbody>
</table>
</div>

<div id="paginationArea" class="mt-3"></div>

</div>
</div>

</div>

<footer class="text-center">
    <p class="mb-1">Enrollment System © 2025</p>
    <p class="small mb-0">IT ELEC 3 – Data Mining</p>
</footer>

<script>
const RECORDS_PER_PAGE = 5;
const params = new URLSearchParams(window.location.search);
let currentPage = parseInt(params.get("page")) || 1;
let searchTerm = (params.get("search") || "").toLowerCase();

/* LOAD DATA */
let rawSubjects = [];
try {
    rawSubjects = JSON.parse(localStorage.getItem("subjects")) || [];
} catch {
    rawSubjects = [];
}

/* NORMALIZE DATA (FIXED NAME HANDLING) */
let subjects = rawSubjects.map((s, i) => ({
    id: s.id || Date.now() + i,
    code: s.code || "",
    name: (s.name && s.name.trim() !== "") ? s.name : "-",
    units: s.units || "-",
    course: s.course || "-",
    yearLevel: s.yearLevel || "-",
    status: s.status || "Inactive"
}));

function getFilteredSubjects() {
    if (!searchTerm) return subjects;
    return subjects.filter(s =>
        s.name.toLowerCase().includes(searchTerm) ||
        s.code.toLowerCase().includes(searchTerm) ||
        s.course.toLowerCase().includes(searchTerm)
    );
}

function renderTable() {
    subjectTable.innerHTML = "";

    const filtered = getFilteredSubjects();
    const start = (currentPage - 1) * RECORDS_PER_PAGE;
    const pageData = filtered.slice(start, start + RECORDS_PER_PAGE);

    if (!pageData.length) {
        subjectTable.innerHTML = `
        <tr>
            <td colspan="8" class="text-center py-3">
                No subject records found
            </td>
        </tr>`;
        return;
    }

    pageData.forEach((s, i) => {
        subjectTable.innerHTML += `
        <tr>
            <td>${start + i + 1}</td>
            <td>${s.code}</td>
            <td>${s.name}</td>
            <td>${s.units}</td>
            <td>${s.course}</td>
            <td>${s.yearLevel}</td>
            <td>
                <span class="badge ${s.status === "Active" ? "bg-success" : "bg-secondary"}">
                    ${s.status}
                </span>
            </td>
            <td>
                <button class="btn btn-warning btn-sm" onclick="editSubject(${s.id})">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger btn-sm" onclick="deleteSubject(${s.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>`;
    });

    renderPagination(filtered.length);
}

function renderPagination(total) {
    paginationArea.innerHTML = "";
    const pages = Math.ceil(total / RECORDS_PER_PAGE);
    for (let i = 1; i <= pages; i++) {
        paginationArea.innerHTML += `
        <a class="btn btn-sm ${i === currentPage ? "btn-success" : "btn-outline-success"} me-1"
           href="?page=${i}&search=${searchTerm}">${i}</a>`;
    }
}

function editSubject(id) {
    localStorage.setItem("editSubject", JSON.stringify(subjects.find(s => s.id === id)));
    location.href = "edit_subject.html";
}

function deleteSubject(id) {
    if (!confirm("Delete this subject?")) return;
    subjects = subjects.filter(s => s.id !== id);
    localStorage.setItem("subjects", JSON.stringify(subjects));
    renderTable();
}

searchInput.value = searchTerm;
clearSearch.classList.toggle("d-none", !searchTerm);

searchForm.onsubmit = e => {
    e.preventDefault();
    location.href = `?search=${searchInput.value}&page=1`;
};

clearSearch.onclick = () => location.href = "subjects.html";

renderTable();
</script>

</body>
</html>
